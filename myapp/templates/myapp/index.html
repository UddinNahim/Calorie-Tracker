<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calorie Tracker</title>

<!-- Bootstrap 5 CDN -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js" crossorigin="anonymous"></script>

<style>
    body {
        background: linear-gradient(to right, #e0f7fa, #f1f8e9);
        font-family: "Helvetica Neue", Arial, sans-serif;
        padding-top: 50px;
    }
    .container-main {
        max-width: 900px;
        background: rgba(255, 255, 255, 0.85);
        border-radius: 20px;
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
        padding: 30px;
        backdrop-filter: blur(8px);
    }
    h1 {
        color: #007aff;
        text-align: center;
        font-weight: 600;
        margin-bottom: 30px;
    }
    select, button {
        border-radius: 12px;
    }
    button {
        background-color: #00bfa5;
        border: none;
        color: white;
        padding: 10px 20px;
        transition: 0.3s;
    }
    button:hover {
        background-color: #007aff;
        transform: scale(1.03);
    }
    table {
        margin-top: 20px;
    }
    th {
        background-color: #007aff;
        color: white;
    }
    td {
        background-color: #f9f9f9;
    }
    .footer {
        text-align: center;
        margin-top: 40px;
        color: #666;
    }
    canvas {
        width: 100% !important;
        height: auto !important;
    }
</style>
</head>

<body>
<div class="container container-main">
    <!-- Navbar -->
    <nav class="navbar navbar-dark bg-primary mb-4">
        <span class="navbar-brand">Calorie Tracker</span>
    </nav>

    <!-- Calorie Goal -->
    <h4>Calorie Goal</h4>
    <div class="progress mb-4">
        <div class="progress-bar bg-warning" role="progressbar" style="width: 0%" aria-valuenow="75"
             aria-valuemin="0" aria-valuemax="100"></div>
    </div>

    <!-- Page Title -->
    <h1>üçè Calorie Tracker</h1>

    <!-- Food Selection -->
    <form method="POST" class="d-flex justify-content-center align-items-center gap-2 mb-4">
        {% csrf_token %}
        <select name="food_consumed" id="food_consumed" class="form-select w-50">
            <option selected disabled>Choose a food...</option>
            {% for food in foods %}
            <option value="{{ food.name }}">{{ food.name }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-success">Add</button>
    </form>

    <!-- Table and Chart Side by Side -->
    <div class="row">
        <!-- Table Column -->
        <div class="col-md-6">
            <table id="table" class="table table-bordered table-hover text-center">
                <thead>
                <tr>
                    <th>Food</th>
                    <th>Carbs (g)</th>
                    <th>Protein (g)</th>
                    <th>Fats (g)</th>
                    <th>Calories (kcal)</th>
                </tr>
                </thead>
                <tbody>
                {% for c in consumed_food %}
                <tr>
                    <td>{{ c.food_consumed.name }}</td>
                    <td>{{ c.food_consumed.carbs }}</td>
                    <td>{{ c.food_consumed.protein }}</td>
                    <td>{{ c.food_consumed.fats }}</td>
                    <td>{{ c.food_consumed.calories }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="5">No food consumed yet üçΩÔ∏è</td>
                </tr>
                {% endfor %}
                <tr>
                    <td><b>Total</b></td>
                    <td id="totalCarbs"><b></b></td>
                    <td id="totalProtein"><b></b></td>
                    <td id="totalFats"><b></b></td>
                    <td id="totalCalories"><b></b></td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Chart Column -->
        <div class="col-md-6">
            <h4>Today's Breakdown</h4>
            <div class="card-header text-white bg-primary mb-2">
                <h4>Macronutrients Breakdown</h4>
            </div>
            <canvas id="acquisitions"></canvas>
        </div>
    </div>
</div>

<div class="footer">
    <p>Made with üíô by Nahim</p>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Calculate totals
    const table = document.getElementById("table");
    let carbs = 0, protein = 0, fats = 0, calories = 0;

    for (let i = 1; i < table.rows.length - 1; i++) {
        carbs += parseFloat(table.rows[i].cells[1].innerText) || 0;
        protein += parseFloat(table.rows[i].cells[2].innerText) || 0;
        fats += parseFloat(table.rows[i].cells[3].innerText) || 0;
        calories += parseFloat(table.rows[i].cells[4].innerText) || 0;
    }

    document.getElementById("totalCarbs").innerText = `${carbs.toFixed(2)} g`;
    document.getElementById("totalProtein").innerText = `${protein.toFixed(2)} g`;
    document.getElementById("totalFats").innerText = `${fats.toFixed(2)} g`;
    document.getElementById("totalCalories").innerText = `${calories.toFixed(2)} kcal`;

    // Update progress bar
    const calPer = (calories / 2000) * 100;
    document.querySelector(".progress-bar").style.width = calPer + "%";

    // Chart: Doughnut
    const total = carbs + protein + fats;
    const carbsP = Math.round((carbs / total) * 100);
    const proteinP = Math.round((protein / total) * 100);
    const fatsP = Math.round((fats / total) * 100);

    const ctx = document.getElementById("acquisitions").getContext("2d");
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ["Carbs " + carbsP + "%", "Protein " + proteinP + "%", "Fats " + fatsP + "%"],
            datasets: [{
                data: [carbsP, proteinP, fatsP],
                backgroundColor: [
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(255, 99, 132, 1)'
                ],
                borderColor: [
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(255, 99, 132, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'bottom' },
                title: { display: true, text: 'Macronutrient Breakdown (Doughnut)' }
            }
        }
    });
</script>
</body>
</html>
